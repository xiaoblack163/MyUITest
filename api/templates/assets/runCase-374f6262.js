import{m as q,p as H,i as J,r as c,x as Q,a as r,b as d,c as C,e as s,d as e,f as u,F as w,g as N,q as j,t as p,y as _,n as T}from"./index-c1bbea3d.js";const W={class:"card"},X=e("h5",null,"选择测试用例",-1),Y={class:"card"},Z=e("h5",null,"运行测试",-1),ee={class:"formgrid grid"},te={class:"field col-12 md:col-3"},le={class:"field col-12 md:col-3"},ae=e("label",{for:"lastname1",class:"p-sr-only"},"测试版本",-1),oe={class:"field col-12 md:col-3"},se=e("label",{for:"lastname1",class:"p-sr-only"},"测试人",-1),ne={class:"field col-12 md:col-3 flex justify-content-between"},ce={class:"card"},re={class:"flex flex-wrap gap-3"},ie={class:"flex justify-content-between gap-5"},ue={class:"flex flex-column gap-1"},de={class:"text-secondary text-sm"},ve={class:"font-bold text-lg"},pe={class:"flex flex-wrap gap-3"},fe={class:"flex justify-content-between gap-5"},me={class:"flex flex-column gap-1"},be={class:"text-secondary text-sm"},_e={class:"font-bold text-lg"},ye={class:"flex flex-wrap gap-3"},xe={class:"flex justify-content-between gap-5"},ge={class:"flex flex-column gap-1"},he={class:"text-secondary text-sm"},Ce={class:"font-bold text-lg"},we={class:"flex justify-content-between mt-3 mb-2 relative"},Te=e("span",null,"测试进度",-1),Ee={class:"card"},Ne={__name:"runCase",setup(Ve){const R=q(),y=H(),f=J("utilss"),m=c([{label:"执行失败率",color1:"#fbbf24",color2:"#ef4444",value:0,icon:"pi pi-inbox"},{label:"断言失败率",color1:"#ef4444",color2:"#34d399",value:0,icon:"pi pi-image"},{label:"通过率",color1:"#34d399",color2:"#34d399",value:0,icon:"pi pi-table"}]),x=c([{label:"全部步骤",color1:"#0EA5E9",value:0,icon:"pi pi-table"},{label:"已测步骤",color1:"#F97316",value:0,icon:"pi pi-inbox"},{label:"未测步骤",color1:"#C0C1C0",value:0,icon:"pi pi-image"}]),g=c([{label:"功能数",color1:"#BEE399",value:0,icon:"pi pi-table"},{label:"用例数",color1:"#1ED6FB",value:0,icon:"pi pi-inbox"},{label:"步骤数",color1:"#F47A7A",value:0,icon:"pi pi-image"}]),B=c(),I=c(),S=(n,a,v)=>{const i=getComputedStyle(document.documentElement);return{labels:n,datasets:[{label:"通过步骤",backgroundColor:i.getPropertyValue("--cyan-500"),data:a},{label:"失败步骤",backgroundColor:i.getPropertyValue("--red-300"),data:v}]}},M=()=>{const n=getComputedStyle(document.documentElement),a=n.getPropertyValue("--text-color"),v=n.getPropertyValue("--text-color-secondary"),i=n.getPropertyValue("--surface-border");return{indexAxis:"y",maintainAspectRatio:!1,aspectRatio:.8,plugins:{legend:{labels:{color:a}}},scales:{x:{ticks:{color:v,font:{weight:500}},grid:{display:!1,drawBorder:!1}},y:{ticks:{color:v},grid:{color:i,drawBorder:!1}}}}},D=c([]),o=c({selectedTreeTableValue:{},testEnv:"",testor:"",version:""}),l=c(),E=async()=>{l.value=await f.GetCaseActivity(y),o.value.testEnv=l.value.testEnv.testEnv,o.value.testor=l.value.testEnv.testor,o.value.version=l.value.testEnv.version,m.value[0].value=(100*(l.value.activity.execFailNumber/l.value.activity.stepNumber)).toFixed(1),m.value[1].value=(100*(l.value.activity.assertFailNumber/l.value.activity.stepNumber)).toFixed(1),m.value[2].value=(100*(l.value.activity.passNumber/l.value.activity.stepNumber)).toFixed(1),x.value[0].value=parseInt(l.value.activity.stepNumber),x.value[1].value=parseInt(l.value.activity.testedNumber),x.value[2].value=parseInt(l.value.activity.stepNumber-l.value.activity.testedNumber),g.value[0].value=parseInt(l.value.activity.funcNumber),g.value[1].value=parseInt(l.value.activity.caseNumber),g.value[2].value=parseInt(l.value.activity.stepNumber),B.value=S(Object.keys(l.value.funcChart.passNumber),Object.values(l.value.funcChart.passNumber),Object.values(l.value.funcChart.failNumber)),I.value=M()},O=()=>{if(o.value.testEnv===""||o.value.testor===""||o.value.version==="")return y.add({severity:"warn",summary:"请输入测试参数",life:3e3}),!1;f.PostRunTestData(y,o.value),setTimeout(()=>{h.value=!1,E()},2e3)},h=c(!1),P=()=>{h.value=!0,setTimeout(()=>{h.value=!1,E()},2e3)},A=()=>{f.StopRunTest(y)},$=n=>{R.require({target:n.currentTarget,message:"停止测试?",icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"取消",acceptLabel:"确认",accept:()=>{A()},reject:()=>{console.log("取消")}})},F=c();return Q(async()=>{var n=await f.GetTestEnvs();F.value=n.map(function(a){return a.testEnvIP}),D.value=await f.GetRunCaseTreeData(),E()}),(n,a)=>{const v=r("ConfirmPopup"),i=r("Column"),U=r("TreeTable"),z=r("Dropdown"),G=r("InputText"),V=r("Button"),k=r("Card"),K=r("MeterGroup"),L=r("Chart");return d(),C(w,null,[s(v),e("div",W,[X,s(U,{value:D.value,selectionMode:"checkbox",selectionKeys:o.value.selectedTreeTableValue,"onUpdate:selectionKeys":a[0]||(a[0]=t=>o.value.selectedTreeTableValue=t)},{default:u(()=>[s(i,{field:"name",header:"名称",expander:!0}),s(i,{field:"id",header:"ID"}),s(i,{field:"type",header:"类型"})]),_:1},8,["value","selectionKeys"])]),e("div",Y,[Z,e("div",ee,[e("div",te,[s(z,{modelValue:o.value.testEnv,"onUpdate:modelValue":a[1]||(a[1]=t=>o.value.testEnv=t),options:F.value,placeholder:"请选择测试环境",class:"w-full"},null,8,["modelValue","options"])]),e("div",le,[ae,s(G,{modelValue:o.value.version,"onUpdate:modelValue":a[2]||(a[2]=t=>o.value.version=t),style:{width:"100%"},type:"text",placeholder:"请输入测试版本"},null,8,["modelValue"])]),e("div",oe,[se,s(G,{modelValue:o.value.testor,"onUpdate:modelValue":a[3]||(a[3]=t=>o.value.testor=t),style:{width:"100%"},type:"text",placeholder:"请输入测试人"},null,8,["modelValue"])]),e("div",ne,[s(V,{label:"运行测试",onClick:O}),s(V,{onClick:a[4]||(a[4]=t=>$(t)),label:"停止测试",severity:"danger",outlined:""}),s(V,{label:"刷新",icon:"pi pi-refresh",loading:h.value,onClick:P,outlined:""},null,8,["loading"])])])]),e("div",ce,[s(K,{value:m.value,labelPosition:"start"},{label:u(()=>[e("div",re,[(d(!0),C(w,null,N(g.value,(t,b)=>(d(),j(k,{key:b,class:"flex-1"},{content:u(()=>[e("div",ie,[e("div",ue,[e("span",de,p(t.label),1),e("span",ve,p(t.value),1)]),e("span",{class:"w-2rem h-2rem border-circle inline-flex justify-content-center align-items-center text-center",style:_({backgroundColor:`${t.color1}`,color:"#ffffff"})},[e("i",{class:T(t.icon)},null,2)],4)])]),_:2},1024))),128))]),e("div",pe,[(d(!0),C(w,null,N(x.value,(t,b)=>(d(),j(k,{key:b,class:"flex-1"},{content:u(()=>[e("div",fe,[e("div",me,[e("span",be,p(t.label),1),e("span",_e,p(t.value),1)]),e("span",{class:"w-2rem h-2rem border-circle inline-flex justify-content-center align-items-center text-center",style:_({backgroundColor:`${t.color1}`,color:"#ffffff"})},[e("i",{class:T(t.icon)},null,2)],4)])]),_:2},1024))),128))]),e("div",ye,[(d(!0),C(w,null,N(m.value,(t,b)=>(d(),j(k,{key:b,class:"flex-1"},{content:u(()=>[e("div",xe,[e("div",ge,[e("span",he,p(t.label),1),e("span",Ce,p(t.value)+"%",1)]),e("span",{class:"w-2rem h-2rem border-circle inline-flex justify-content-center align-items-center text-center",style:_({backgroundColor:`${t.color1}`,color:"#ffffff"})},[e("i",{class:T(t.icon)},null,2)],4)])]),_:2},1024))),128))])]),meter:u(t=>[e("span",{class:T(t.class),style:_({background:`linear-gradient(to right, ${t.value.color1}, ${t.value.color2})`,width:t.size})},null,6)]),start:u(({totalPercent:t})=>[e("div",we,[Te,e("span",{style:_({width:t+"%"}),class:"absolute text-right"},null,4)])]),end:u(()=>[]),_:1},8,["value"])]),e("div",Ee,[s(L,{type:"bar",data:B.value,options:I.value,class:"h-30rem"},null,8,["data","options"])])],64)}}};export{Ne as default};
