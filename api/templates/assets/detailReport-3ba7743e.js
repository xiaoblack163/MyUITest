import{i as O,r as c,v as J,a as u,b as p,c as f,e as l,f as i,d as e,F as C,s as R,q as N,g as M,t as v,x as _,n as b,j as K}from"./index-db2382d8.js";const Q={class:"card"},W={key:0,controls:"",width:"80%"},X=["src"],Y={class:"card"},Z={class:"flex flex-wrap gap-3"},P={class:"flex justify-content-between gap-5"},ee={class:"flex flex-column gap-1"},te={class:"text-secondary text-sm"},le={class:"font-bold text-lg"},ae={class:"flex flex-wrap gap-3"},se={class:"flex justify-content-between gap-5"},oe={class:"flex flex-column gap-1"},ne={class:"text-secondary text-sm"},ie={class:"font-bold text-lg"},ce={class:"flex flex-wrap gap-3"},re={class:"flex justify-content-between gap-5"},de={class:"flex flex-column gap-1"},ue={class:"text-secondary text-sm"},pe={class:"font-bold text-lg"},ve={class:"flex justify-content-between mt-3 mb-2 relative"},me=e("span",null,"测试进度",-1),he={class:"card"},fe={class:"card"},_e=e("h5",null,"测试报告",-1),be={class:"flex align-items-center gap-2",style:{color:"#0D8ADB"}},ye=e("i",{class:"pi pi-th-large",style:{height:"1rem","margin-right":"0.5rem"}},null,-1),ge={style:{"text-align":"right"},class:"text-bold pr-6"},xe=e("i",{class:"pi pi-star",style:{height:"1rem","margin-right":"0.5rem"}},null,-1),we={style:{"text-align":"right"},class:"text-bold pr-6"},ke={__name:"detailReport",setup(Ce){const S=O("utilss"),V=O("storee"),B=c([]),$=()=>{const o=["danger","success","info","warning","secondary","help","contrast"],r=Math.floor(Math.random()*o.length);return o[r]},y=c([{label:"执行失败率",color1:"#fbbf24",color2:"#ef4444",value:0,icon:"pi pi-inbox"},{label:"断言失败率",color1:"#ef4444",color2:"#34d399",value:0,icon:"pi pi-image"},{label:"通过率",color1:"#34d399",color2:"#34d399",value:0,icon:"pi pi-table"}]),g=c([{label:"全部步骤",color1:"#0EA5E9",value:0,icon:"pi pi-table"},{label:"已测步骤",color1:"#F97316",value:0,icon:"pi pi-inbox"},{label:"未测步骤",color1:"#C0C1C0",value:0,icon:"pi pi-image"}]),x=c([{label:"功能数",color1:"#BEE399",value:0,icon:"pi pi-table"},{label:"用例数",color1:"#1ED6FB",value:0,icon:"pi pi-inbox"},{label:"步骤数",color1:"#F47A7A",value:0,icon:"pi pi-image"}]),j=c(),F=c(),T=(o,r,d)=>{const m=getComputedStyle(document.documentElement);return{labels:o,datasets:[{label:"通过步骤",backgroundColor:m.getPropertyValue("--cyan-500"),data:r},{label:"失败步骤",backgroundColor:m.getPropertyValue("--red-300"),data:d}]}},z=()=>{const o=getComputedStyle(document.documentElement),r=o.getPropertyValue("--text-color"),d=o.getPropertyValue("--text-color-secondary"),m=o.getPropertyValue("--surface-border");return{indexAxis:"y",maintainAspectRatio:!1,aspectRatio:.8,plugins:{legend:{labels:{color:r}}},scales:{x:{ticks:{color:d,font:{weight:500}},grid:{display:!1,drawBorder:!1}},y:{ticks:{color:d},grid:{color:m,drawBorder:!1}}}}},k=c(!1),G=c(" "),w=c(""),I=c(""),A=(o,r,d)=>{k.value=!0,I.value=o,G.value=r,o==="video"?w.value=V.host+"/screencast/"+d+".webm":w.value=V.host+"/screenshot/"+d+".png"},a=c();return J(async()=>{const o=localStorage.getItem("reportID");B.value=await S.GetDetaiReports(o),a.value=await S.GetDetaiChart(o),y.value[0].value=(100*(a.value.activity.execFailNumber/a.value.activity.stepNumber)).toFixed(1),y.value[1].value=(100*(a.value.activity.assertFailNumber/a.value.activity.stepNumber)).toFixed(1),y.value[2].value=(100*(a.value.activity.passNumber/a.value.activity.stepNumber)).toFixed(1),g.value[0].value=parseInt(a.value.activity.stepNumber),g.value[1].value=parseInt(a.value.activity.testedNumber),g.value[2].value=parseInt(a.value.activity.stepNumber-a.value.activity.testedNumber),x.value[0].value=parseInt(a.value.activity.funcNumber),x.value[1].value=parseInt(a.value.activity.caseNumber),x.value[2].value=parseInt(a.value.activity.stepNumber),j.value=T(Object.keys(a.value.passNumber),Object.values(a.value.passNumber),Object.values(a.value.failNumber)),F.value=z()}),(o,r)=>{const d=u("Image"),m=u("Sidebar"),D=u("Card"),U=u("MeterGroup"),q=u("Chart"),E=u("Button"),n=u("Column"),H=u("Tag"),L=u("DataTable");return p(),f(C,null,[l(m,{visible:k.value,"onUpdate:visible":r[0]||(r[0]=t=>k.value=t),header:G.value,position:"full"},{default:i(()=>[e("div",Q,[I.value==="video"?(p(),f("video",W,[e("source",{src:w.value,type:"video/webm"},null,8,X)])):R("",!0),I.value==="img"?(p(),N(d,{key:1,src:w.value,alt:"Image",width:"80%"},null,8,["src"])):R("",!0)])]),_:1},8,["visible","header"]),e("div",Y,[l(U,{value:y.value,labelPosition:"start"},{label:i(({value:t})=>[e("div",Z,[(p(!0),f(C,null,M(x.value,(s,h)=>(p(),N(D,{key:h,class:"flex-1"},{content:i(()=>[e("div",P,[e("div",ee,[e("span",te,v(s.label),1),e("span",le,v(s.value),1)]),e("span",{class:"w-2rem h-2rem border-circle inline-flex justify-content-center align-items-center text-center",style:_({backgroundColor:`${s.color1}`,color:"#ffffff"})},[e("i",{class:b(s.icon)},null,2)],4)])]),_:2},1024))),128))]),e("div",ae,[(p(!0),f(C,null,M(g.value,(s,h)=>(p(),N(D,{key:h,class:"flex-1"},{content:i(()=>[e("div",se,[e("div",oe,[e("span",ne,v(s.label),1),e("span",ie,v(s.value),1)]),e("span",{class:"w-2rem h-2rem border-circle inline-flex justify-content-center align-items-center text-center",style:_({backgroundColor:`${s.color1}`,color:"#ffffff"})},[e("i",{class:b(s.icon)},null,2)],4)])]),_:2},1024))),128))]),e("div",ce,[(p(!0),f(C,null,M(t,(s,h)=>(p(),N(D,{key:h,class:"flex-1"},{content:i(()=>[e("div",re,[e("div",de,[e("span",ue,v(s.label),1),e("span",pe,v(s.value)+"%",1)]),e("span",{class:"w-2rem h-2rem border-circle inline-flex justify-content-center align-items-center text-center",style:_({backgroundColor:`${s.color1}`,color:"#ffffff"})},[e("i",{class:b(s.icon)},null,2)],4)])]),_:2},1024))),128))])]),meter:i(t=>[e("span",{class:b(t.class),style:_({background:`linear-gradient(to right, ${t.value.color1}, ${t.value.color2})`,width:t.size})},null,6)]),start:i(({totalPercent:t})=>[e("div",ve,[me,e("span",{style:_({width:t+"%"}),class:"absolute text-right"},null,4)])]),end:i(()=>[]),_:1},8,["value"])]),e("div",he,[l(q,{type:"bar",data:j.value,options:F.value,class:"h-30rem"},null,8,["data","options"])]),e("div",fe,[_e,l(L,{value:B.value,showGridlines:"",rowGroupMode:"subheader",groupRowsBy:"caseID",sortMode:"single",selectionMode:"single",sortField:"caseID",sortOrder:1,scrollable:"",scrollHeight:"48vh"},{groupheader:i(t=>[e("div",be,[l(E,{onClick:s=>A("video",t.data.caseName,t.data.reportID+t.data.caseID),type:"button",icon:"pi pi-youtube",rounded:"",style:{"margin-right":"1.5rem"}},null,8,["onClick"]),ye,e("td",ge,"测试功能: "+v(t.data.funcName),1),xe,e("td",we,"测试用例: "+v(t.data.caseName),1)])]),default:i(()=>[l(n,{headerStyle:"width: 5rem; text-align: center",bodyStyle:"text-align: center; overflow: visible"},{body:i(({data:t})=>[l(E,{onClick:s=>A("img",t.stepName,t.detailReportID),type:"button",icon:"pi pi-image",rounded:""},null,8,["onClick"])]),_:1}),l(n,{field:"caseID",header:"caseID"}),l(n,{field:"stepName",header:"步骤",style:{"min-width":"300px"},class:"font-bold"}),l(n,{field:"execDate",header:"测试时间",style:{"min-width":"200px"}}),l(n,{field:"action",header:"动作",style:{"min-width":"200px"}}),l(n,{field:"AssertOrActionValue",header:"输入参数",style:{"min-width":"200px"}}),l(n,{field:"locatMode",header:"定位方式",style:{"min-width":"120px"}},{body:i(t=>[l(H,{severity:$(t.data.locatMode)},{default:i(()=>[K(v(t.data.locatMode.toUpperCase()),1)]),_:2},1032,["severity"])]),_:1}),l(n,{field:"locatValue",header:"定位值",style:{"min-width":"200px"}}),l(n,{field:"yoloValue",header:"目标检测元素",style:{"min-width":"200px"}}),l(n,{field:"elementNumber",header:"元素序号",style:{"min-width":"100px"}}),l(n,{field:"xValue",header:"x坐标",style:{"min-width":"100px"}}),l(n,{field:"yValue",header:"y坐标",style:{"min-width":"100px"}}),l(n,{field:"stepInfo",header:"步骤说明",style:{"min-width":"200px"}}),l(n,{field:"execInfo",header:"步骤执行信息",style:{"min-width":"200px"}}),l(n,{field:"result",header:"测试结果",frozen:"",alignFrozen:"right",style:{"min-width":"100px"}},{body:i(({data:t})=>[e("i",{class:b(["pi",{"text-green-500 pi-check-circle":t.result,"text-pink-500 pi-times-circle":!t.result}])},null,2)]),_:1})]),_:1},8,["value"])])],64)}}};export{ke as default};
